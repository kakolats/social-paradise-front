<section class="w-full max-w-xl mx-auto p-4">
    <h1 class="text-xl font-semibold text-slate-900 mb-3">
        Scan du ticket (QR Code)
    </h1>

    <!-- Scanner -->
    <div class="rounded-2xl border border-slate-200 bg-black/5 p-3 mb-4">
        <div
            *ngIf="scanning()"
            id="html5qr-reader"
            class="block w-full aspect-[3/4] bg-black rounded-xl overflow-hidden"
        ></div>

        <div *ngIf="!scanning()" class="text-sm text-slate-500">
            Scanner en pause.
        </div>
    </div>

    <!-- Bloc STATUT (icône + texte) -->
    <div
        *ngIf="status() !== 'SCANNING' && status() !== 'IDLE'"
        class="mb-3 flex flex-col items-center justify-center rounded-2xl border px-4 py-6 text-center"
        [ngClass]="{
      'border-slate-200 bg-white': status() === 'LOADING',
      'border-rose-300 bg-rose-50': status() === 'INVALID',
      'border-emerald-300 bg-emerald-50': status() === 'VALID',
      'border-red-300 bg-red-50': status() === 'ALREADY_USED'
    }"
    >
        <!-- Icônes -->
        <mat-icon
            *ngIf="status() === 'VALID'"
            [svgIcon]="'heroicons_solid:check-circle'"
            class="!w-20 !h-20 text-green-500 mb-3"
        ></mat-icon>

        <mat-icon
            *ngIf="status() === 'INVALID' || status() === 'ALREADY_USED'"
            [svgIcon]="'heroicons_solid:x-circle'"
            class="!w-20 !h-20 text-red-500 mb-3"
        ></mat-icon>

        <mat-icon
            *ngIf="status() === 'LOADING'"
            [svgIcon]="'heroicons_solid:arrow-path'"
            class="!w-20 !h-20 text-slate-500 mb-3 animate-spin"
        ></mat-icon>

        <!-- Texte -->
        <div
            class="text-base font-semibold"
            [ngClass]="{
        'text-slate-800': status() === 'LOADING',
        'text-rose-800': status() === 'INVALID',
        'text-emerald-800': status() === 'VALID',
        'text-red-800': status() === 'ALREADY_USED'
      }"
        >
            {{ statusMessage() }}
        </div>
    </div>

    <!-- Bloc INFOS (uniquement si guest existe) -->
    <div
        *ngIf="guest() as g"
        class="mb-4 rounded-2xl border p-4"
        [ngClass]="{
      'border-emerald-300 bg-emerald-50': status() === 'VALID',
      'border-red-300 bg-red-50': status() === 'ALREADY_USED',
      'border-slate-200 bg-white': status() !== 'VALID' && status() !== 'ALREADY_USED'
    }"
    >
        <div class="text-center mb-3">
            <div class="text-lg font-semibold text-slate-900">
                {{ guestFullName() }}
            </div>
            <div class="text-xs text-slate-500 mt-1">
                Slug : <span class="font-mono">{{ g.slug }}</span>
            </div>
        </div>

        <div class="grid gap-2 text-sm text-slate-700">
            <div><span class="font-medium">Email :</span> {{ g.email }}</div>

            <div *ngIf="g.phoneNumber">
                <span class="font-medium">Téléphone :</span> {{ g.phoneNumber }}
            </div>

            <div *ngIf="g.age">
                <span class="font-medium">Âge :</span> {{ g.age }}
            </div>
        </div>
    </div>

    <!-- Actions -->
    <div class="flex justify-end gap-2">
        <button
            type="button"
            (click)="resetScan()"
            class="rounded-xl border border-slate-300 bg-white px-4 py-2 text-sm font-semibold text-slate-700 shadow-sm hover:bg-slate-50"
        >
            Réinitialiser / Re-scanner
        </button>
    </div>
</section>
